argo-cd:
  redis-ha:
    enabled: true

  controller:
    replicas: 1

  configs:
    knownHosts:
      data:
        ssh_known_hosts: |
          bitbucket.org ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAubiN81eDcafrgMeLzaFPsw2kNvEcqTKl/VqLat/MaB33pZy0y3rJZtnqwR2qOOvbwKZYKiEO1O6VqNEBxKvJJelCq0dTXWT5pbO2gDXC6h6QDXCaHo6pOHGPUy+YBaGQRGuSusMEASYiWunYN0vCAI8QaXnWMXNMdFP3jHAJH0eDsoiGnLPBlBp4TNm6rYI74nMzgz3B9IikW4WVK+dc8KZJZWYjAuORU3jc1c/NPskD2ASinf8v3xnfXeukU0sJ5N6m5E8VLjObPEO+mN2t/FZTMZLiFqPWc/ALSqnMnnhwrNi2rbfg/rd/IpL8Le3pSBne8+seeFVBoGqzHM9yXw==
          github.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg=
          github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
          github.com ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEAq2A7hRGmdnm9tUDbO9IDSwBK6TbQa+PXYPCPy6rbTrTtw7PHkccKrpp0yVhp5HdEIcKr6pLlVDBfOLX9QUsyCOV0wzfjIJNlGEYsdlLJizHhbn2mUjvSAHQqZETYP81eFzLQNnPHt4EVVUh7VfDESU84KezmD5QlWpXLmvU31/yMf+Se8xhHTvKSCZIFImWwoG6mbUoWf9nzpIoaSjB+weqqUUmpaaasXVal72J+UX2B+2RPW3RcT0eOzQgqlJL3RKrTJvdsjE3JEAvGq3lGHSZXy28G3skua2SmVi/w4yCE6gbODqnTWlg7+wC604ydGXA8VJiS5ap43JXiUFFAaQ==
          gitlab.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBFSMqzJeV9rUzU4kWitGjeR4PWSa29SPqJ1fVkhtj3Hw9xjLVXVYrU9QlYWrOLXBpQ6KWjbjTDTdDkoohFzgbEY=
          gitlab.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf
          gitlab.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCsj2bNKTBSpIYDEGk9KxsGh3mySTRgMtXL583qmBpzeQ+jqCMRgBqB98u3z++J1sKlXHWfM9dyhSevkMwSbhoR8XIq/U0tCNyokEi/ueaBMCvbcTHhO7FcwzY92WK4Yt0aGROY5qX2UKSeOvuP4D6TPqKF1onrSzH9bx9XUf2lEdWT/ia1NEKjunUqu1xOB/StKDHMoX4/OKyIzuS0q/T1zOATthvasJFoPrAjkohTyaDUz2LN5JoH839hViyEG82yB+MjcFV5MU3N1l1QL3cVUCh93xSaua1N85qivl+siMkPGbO5xR/En4iEY6K2XPASUEMaieWVNTRCtJ4S8H+9
          ssh.dev.azure.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7Hr1oTWqNqOlzGJOfGJ4NakVyIzf1rXYd4d7wo6jBlkLvCA4odBlL0mDUyZ0/QUfTTqeu+tm22gOsv+VrVTMk6vwRU75gY/y9ut5Mb3bR5BV58dKXyq9A9UeB5Cakehn5Zgm6x1mKoVyf+FFn26iYqXJRgzIZZcZ5V6hrE0Qg39kZm4az48o0AUbf6Sp4SLdvnuMa2sVNwHBboS7EJkm57XQPVU3/QpyNLHbWDdzwtrlS+ez30S3AdYhLKEOxAG8weOnyrtLJAUen9mTkol8oII1edf7mWWbWVf0nBmly21+nZcmCTISQBtdcyPaEno7fFQMDD26/s0lfKob4Kw8H
          vs-ssh.visualstudio.com ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7Hr1oTWqNqOlzGJOfGJ4NakVyIzf1rXYd4d7wo6jBlkLvCA4odBlL0mDUyZ0/QUfTTqeu+tm22gOsv+VrVTMk6vwRU75gY/y9ut5Mb3bR5BV58dKXyq9A9UeB5Cakehn5Zgm6x1mKoVyf+FFn26iYqXJRgzIZZcZ5V6hrE0Qg39kZm4az48o0AUbf6Sp4SLdvnuMa2sVNwHBboS7EJkm57XQPVU3/QpyNLHbWDdzwtrlS+ez30S3AdYhLKEOxAG8weOnyrtLJAUen9mTkol8oII1edf7mWWbWVf0nBmly21+nZcmCTISQBtdcyPaEno7fFQMDD26/s0lfKob4Kw8H
          git.sh4ke.rocks ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDL1zFKrzEACGxLWVaZN03Gcr7/gHoXDTUaMyc1hdA9+9uLHWt43YJNjXGdjnHPLCSI0PnVPxxrt818+D1kVAHslcFmVg9GE0u2k33sn8AcsxmFPE9B07fz5pXuPciVK3U1E5uYJYgZvUIEtYy7iCpZ25Re/lfeXWPbTwcQYk46E6tyU2QrmpdydNbA6Mn5OpJHsKI767nsLep+bCzXJ1g060mUTD0KRfWEKttH1ECYD7+hp57zqJRG4ZdqchqUNjfs1o7vlxc9tU6pSQ5Ea5Ghd305YREUDdC+86VcoPMJ9jiJc78TwNTXLJl/ur7GWRDq3A6BrYmvPum0iubz0EBr8bmZCjT5WKWGrJkOAVXQWDNRuqUf6i0NN2kTbbyPB9ucd06f7OpdYbEFetxDDi7vCyqMEzUPAXmoYK2VyK+k3DjGMcI3Sz+/dsDAIL5X0n3DtfJDNf//kdfhpufswn36LWaOHaXy28ui/I+1mKxol7GpeZrqnLuQ82o68p0jhdolSYfv/N9N97sp8/oT6AA6cwnstCHkyK8ImpxfF/4aVlOPPSqI08znb+OvtrIelt1gT/WbFoXOUzklYgb79zQlDmSf2AQeyN3WCfU3rIgiFfn5GaDNGPuCzigX0gKo83Sm22ktyA888dAwXyjaLhrp4AXrTyYD1Nc4PgMeZ+wD0w==
          git.sh4ke.rocks ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPbQEBa9+4kHdWbwJxDUhyTPM/UDLm1tmP3rW8xZ4MPr
          [gitea.ws.sh4ke.rocks]:2222 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQCpf9B1MzVjBq9R/BbbN16VVZmfpUQZSHwVUZghv+rIRR3PV5LtTFkTT+Tt665lYsWJjHWS3NpjO8PdXSYVlAD7x1OXI8LVQKPrbg04qI30EAk1xNwQJZGV1DL9NHMem+f2aXFNtV5745NFag4qqeBUVuWlClIuiqVj173LhkXT5VW7HW7p6OjBY3j6kxKuq4scMsb879O4m1JRq2RflwmEmSTTwLxWbgwh9gINbn8bZOymX/gOniblnqhDVjEKoj/EOXUqkI7LaQ8RacCKjp2drBr78pY/rVWluMq7F3eb+1SguaColLQC81V4Smtx+Vscnkw4fbOrEU9CDF+g//ZUp2CFXCHb/ev8piBixl4mlu5AFWxeEleYPxS/1WRdSIVuJ4mkpmQzqemXAJjq8xXTeRNIiAJp7/ZG8g7UAN8Dsf3sJ/GaSIv5cJPQuFbvdhVauA9xH5oc74A1AN7J5lFkrR8ko2UEHVhx0gULTC5DOb3NjkCsEawLQ2wVNCdpdy129Zqh3d/0URaIWglFkpQ5dyOTpnvvKBnhzYCCh0nozxl4XrrE3bz18KZBjHjcgivMMd6St5xzajS4/puQnJjSryYe3Diu+Ia7cHgZF/C8EzKIxmZzwAoJmdYNuvjkKp+OqvbvQxI9cNBBS8z21nvmtGjrlfcCC90lArE8tYi5JQ==

  server:
    replicas: 2
    configEnabled: true
    ingress:
      annotations:
        nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    config:
      sshConfigs: |
        Host gitea.os.sh4ke.rocks
            KexAlgorithms ecdh-sha2-nistp521
        Host gitea.ws.sh4ke.rocks
            KexAlgorithms ecdh-sha2-nistp521
      configManagementPlugins: |
        - name: kustomized-helm
          init:
            command: ["/bin/sh", "-c"]
            args: ["helm dependency build || true"]
          generate:
            command: ["/bin/sh", "-c"]
            args: ["helm template . --name-template $ARGOCD_APP_NAME --namespace $ARGOCD_APP_NAMESPACE -f values.yaml --include-crds > all.yaml && kustomize build"]
        - name: argocd-vault-plugin
          generate:
            command: ["argocd-vault-plugin"]
            args: ["generate", "./"]
        - name: argocd-vault-plugin-helm
          init:
            command: [sh, -c]
            args: ["helm dependency build"]
          generate:
            command: ["sh", "-c"]
            args: ["helm template $ARGOCD_APP_NAME --namespace $ARGOCD_APP_NAMESPACE ${helm_args} ${ARGOCD_ENV_PLUGIN_PARAMS} . --include-crds | argocd-vault-plugin generate -"]
        - name: argocd-vault-plugin-helm-kustomize
          init:
            command: [sh, -c]
            args: ["helm dependency build"]
          generate:
            command: ["sh", "-c"]
            args: ["helm template $ARGOCD_APP_NAME --namespace $ARGOCD_APP_NAMESPACE ${helm_args} ${ARGOCD_ENV_PLUGIN_PARAMS} . --include-crds > all.yaml && kustomize build | argocd-vault-plugin generate -"]

  repoServer:
    replicas: 2
    initContainers:
      - name: download-tools
        image: busybox:latest
        command: [sh, -c]
        env:
          - name: AVP_VERSION
            value: "1.12.0"
        args:
          - >-
            wget -O argocd-vault-plugin
            https://github.com/argoproj-labs/argocd-vault-plugin/releases/download/v${AVP_VERSION}/argocd-vault-plugin_${AVP_VERSION}_linux_amd64 &&
            chmod +x argocd-vault-plugin &&
            mv argocd-vault-plugin /custom-tools/
        volumeMounts:
          - mountPath: /custom-tools
            name: custom-tools
    volumes:
      - name: custom-tools
        emptyDir: {}
      - name: ssh-configs
        configMap:
          name: argocd-cm
          items:
            - key: sshConfigs
              path: config
    volumeMounts:
      - name: custom-tools
        mountPath: /usr/local/bin/argocd-vault-plugin
        subPath: argocd-vault-plugin
      - name: ssh-configs
        mountPath: /home/argocd/.ssh/
    envFrom:
      - secretRef:
          name: argocd-vault-plugin-credentials

    applicationSet:
      replicas: 2

